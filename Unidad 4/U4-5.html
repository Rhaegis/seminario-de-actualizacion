<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividad 5 - WebComponent con Modal</title>

    <!-- W3.CSS -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <style>
        .contenedor {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            gap: 20px;
            margin-top: 40px;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background-color: #3e8e41;
        }

        .email-tag {
            display: inline-block;
            background-color: #2196F3;
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 13px;
        }

        .w3-table-all tr:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }

        /* Estilo interno del modal */
        .modal-content {
            padding: 20px;
        }

        .modal-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .w3-modal-content {
            max-width: 500px;
            border-radius: 8px;
        }
    </style>
</head>

<body>

    <usuarios-modal></usuarios-modal>

    <script>
        class UsuariosModal extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });

                this.shadowRoot.innerHTML = `
          <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
          <div class="contenedor w3-card w3-padding">
            <h2 class="w3-center">Actividad 5 - Usuarios con Modal</h2>
            <button id="btnSolicitud" class="w3-button w3-green">Efectuar Solicitud</button>

            <div class="w3-responsive" style="width:100%;">
              <table id="tabla" class="w3-table-all w3-hoverable w3-card-4">
                <thead class="w3-blue">
                  <tr>
                    <th>ID</th>
                    <th>Usuario</th>
                    <th>Nombre</th>
                    <th>Correo</th>
                    <th>Web</th>
                    <th>Celular</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <!-- Modal -->
          <div id="modal" class="w3-modal">
            <div class="w3-modal-content w3-animate-top w3-card-4">
              <header class="w3-container w3-blue">
                <span id="cerrar" class="w3-button w3-display-topright">&times;</span>
                <h3>Detalles del Usuario</h3>
              </header>
              <div class="w3-container modal-content">
                <p>Cargando datos...</p>
              </div>
              <footer class="w3-container w3-light-grey w3-padding">
                <button id="cerrarFooter" class="w3-button w3-red w3-round">Cerrar</button>
              </footer>
            </div>
          </div>
        `;
            }

            connectedCallback() {
                const boton = this.shadowRoot.querySelector('#btnSolicitud');
                const cuerpoTabla = this.shadowRoot.querySelector('tbody');
                const modal = this.shadowRoot.querySelector('#modal');
                const cerrar = this.shadowRoot.querySelector('#cerrar');
                const cerrarFooter = this.shadowRoot.querySelector('#cerrarFooter');
                const modalContent = this.shadowRoot.querySelector('.modal-content');

                // Cierra el modal
                const cerrarModal = () => modal.style.display = 'none';
                cerrar.onclick = cerrarModal;
                cerrarFooter.onclick = cerrarModal;

                boton.addEventListener('click', async () => {
                    boton.disabled = true;
                    boton.textContent = 'Cargando...';

                    try {
                        const respuesta = await fetch('https://jsonplaceholder.typicode.com/users');
                        if (!respuesta.ok) throw new Error(`Error HTTP: ${respuesta.status}`);

                        const datos = await respuesta.json();
                        cuerpoTabla.innerHTML = '';

                        datos.forEach(usuario => {
                            const fila = document.createElement('tr');
                            fila.innerHTML = `
                <td>${usuario.id}</td>
                <td>${usuario.username}</td>
                <td>${usuario.name}</td>
                <td><span class="email-tag w3-tag w3-round w3-blue">${usuario.email}</span></td>
                <td>${usuario.website}</td>
                <td>${usuario.phone}</td>
              `;

                            // Evento: abrir modal al hacer click en la fila
                            fila.addEventListener('click', async () => {
                                modal.style.display = 'block';
                                modalContent.innerHTML = `<p>Cargando datos del usuario...</p>`;

                                try {
                                    const resDetalle = await fetch(`https://jsonplaceholder.typicode.com/users/${usuario.id}`);
                                    const detalle = await resDetalle.json();

                                    modalContent.innerHTML = `
                    <div class="modal-title">Dirección</div>
                    <p><strong>Calle:</strong> ${detalle.address.street}</p>
                    <p><strong>Suite:</strong> ${detalle.address.suite}</p>
                    <p><strong>Ciudad:</strong> ${detalle.address.city}</p>
                    <p><strong>Código Postal:</strong> ${detalle.address.zipcode}</p>
                    <hr>
                    <div class="modal-title">Compañía</div>
                    <p><strong>Nombre:</strong> ${detalle.company.name}</p>
                    <p><strong>Frase:</strong> ${detalle.company.catchPhrase}</p>
                    <p><strong>BS:</strong> ${detalle.company.bs}</p>
                  `;
                                } catch (error) {
                                    modalContent.innerHTML = `<p>Error al cargar detalles: ${error.message}</p>`;
                                }
                            });

                            cuerpoTabla.appendChild(fila);
                        });

                    } catch (error) {
                        cuerpoTabla.innerHTML = `<tr><td colspan="6">Ocurrió un error: ${error.message}</td></tr>`;
                    } finally {
                        boton.disabled = false;
                        boton.textContent = 'Efectuar Solicitud';
                    }
                });
            }
        }

        customElements.define('usuarios-modal', UsuariosModal);
    </script>
</body>

</html>
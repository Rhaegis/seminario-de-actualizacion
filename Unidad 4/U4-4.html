<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividad 4 - WebComponent con W3.CSS</title>

    <!-- Enlace a W3.CSS -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <style>
        .contenedor {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            gap: 20px;
            margin-top: 40px;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background-color: #3e8e41;
        }

        .w3-table-all tr:hover {
            background-color: #f1f1f1;
        }

        .email-tag {
            display: inline-block;
            background-color: #2196F3;
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 13px;
        }
    </style>
</head>

<body>

    <usuarios-tabla></usuarios-tabla>

    <script>
        class UsuariosTabla extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });

                this.shadowRoot.innerHTML = `
          <div class="contenedor w3-card w3-padding">
            <h2 class="w3-center">Actividad 4 - Tabla de Usuarios</h2>
            <button id="btnSolicitud" class="w3-button w3-green">Efectuar Solicitud</button>

            <div class="w3-responsive" style="width:100%;">
              <table id="tabla" class="w3-table-all w3-hoverable w3-card-4">
                <thead class="w3-blue">
                  <tr>
                    <th>ID</th>
                    <th>Usuario</th>
                    <th>Nombre</th>
                    <th>Correo</th>
                    <th>Web</th>
                    <th>Celular</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        `;
            }

            connectedCallback() {
                const boton = this.shadowRoot.querySelector('#btnSolicitud');
                const cuerpoTabla = this.shadowRoot.querySelector('tbody');

                boton.addEventListener('click', async () => {
                    boton.disabled = true;
                    boton.textContent = 'Cargando...';

                    try {
                        const respuesta = await fetch('https://jsonplaceholder.typicode.com/users');
                        if (!respuesta.ok) throw new Error(`Error HTTP: ${respuesta.status}`);

                        const datos = await respuesta.json();

                        // Limpiar contenido previo
                        cuerpoTabla.innerHTML = '';

                        // Agregar filas con los campos solicitados
                        datos.forEach(usuario => {
                            const fila = document.createElement('tr');

                            const celdaId = document.createElement('td');
                            celdaId.textContent = usuario.id;

                            const celdaUsername = document.createElement('td');
                            celdaUsername.textContent = usuario.username;

                            const celdaNombre = document.createElement('td');
                            celdaNombre.textContent = usuario.name;

                            const celdaCorreo = document.createElement('td');
                            const tagCorreo = document.createElement('span');
                            tagCorreo.className = 'email-tag w3-tag w3-round w3-blue';
                            tagCorreo.textContent = usuario.email;
                            celdaCorreo.appendChild(tagCorreo);

                            const celdaWeb = document.createElement('td');
                            celdaWeb.textContent = usuario.website;

                            const celdaTelefono = document.createElement('td');
                            celdaTelefono.textContent = usuario.phone;

                            fila.appendChild(celdaId);
                            fila.appendChild(celdaUsername);
                            fila.appendChild(celdaNombre);
                            fila.appendChild(celdaCorreo);
                            fila.appendChild(celdaWeb);
                            fila.appendChild(celdaTelefono);

                            cuerpoTabla.appendChild(fila);
                        });

                    } catch (error) {
                        cuerpoTabla.innerHTML = `<tr><td colspan="6">Ocurri√≥ un error: ${error.message}</td></tr>`;
                    } finally {
                        boton.disabled = false;
                        boton.textContent = 'Efectuar Solicitud';
                    }
                });
            }
        }

        customElements.define('usuarios-tabla', UsuariosTabla);
    </script>

</body>

</html>